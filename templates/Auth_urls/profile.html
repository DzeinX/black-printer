{% extends 'base.html' %}

{% block title %}Профиль{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename='js/SelectInput.js') }}"></script>
    <script>
        let items = {{ counter_buildings }};

        function AddItem() {
            const table = document.getElementById("table").getElementsByTagName('tbody')[0];
            items++;
            let id = "d" + items
            let newRow = table.insertRow()
            newRow.setAttribute('id', id)
            let tdFirst = document.createElement("td")
            tdFirst.setAttribute('style', 'border: none; padding: 10px 20px 0 0')
            let tdSecond = document.createElement("td")
            tdSecond.setAttribute('style', 'border: none; padding: 10px 10px 0 0')
            let tdThird = document.createElement("td")
            tdThird.setAttribute('style', 'border: none; padding: 10px 0 0 0')
            tdFirst.innerHTML = `
                <td style="border: none">
                    <label for="${items}">${items} </label>
                </td>`;
            tdSecond.innerHTML = `
                <td style="border: none">
                    <select id="${items}"
                            type="text"
                            name="building"
                            class="select">
                        {% for in_all_building in buildings %}
                            {% if in_all_building == building %}
                                <option value="{{ in_all_building.id }}" selected>{{ in_all_building.building }}</option>
                            {% else %}
                                <option value="{{ in_all_building.id }}">{{ in_all_building.building }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </td>`;
            tdThird.innerHTML = `
                <td>
                    <input type="button" value="✕" class="delete_btn" onclick="RemoveItem('d${items}');" id="r${items}">
                </td>`;
            newRow.appendChild(tdFirst)
            newRow.appendChild(tdSecond)
            newRow.appendChild(tdThird)

            $('select').select2({
                    placeholder: "Выберите",
                    allowClear: true
            });
        }

        function RemoveItem(id_div) {
            const div = document.getElementById(id_div);
            div.remove();
            items--;
        }

    </script>
{% endblock %}

{% block body %}
    <h1>Профиль:</h1>
    <div class="align-center">
        <form method="POST">
            <div class="form" id="items">
                {% for message in get_flashed_messages() %}
                    <div class="msg"><strong>{{ message }}</strong></div>
                {% endfor %}
                {% set counter = namespace(value=1) %}
                <table style="border: none" id="table">
                    <colgroup>
                        <col span="1" style="width: 5%;">
                        <col span="1" style="width: calc(95% - 28px);">
                        <col span="1" style="width: 28px;">
                    </colgroup>
                    <tbody>
                    {% for building in current_buildings %}
                        <tr id="d{{ loop.index }}">
                            <td style="border: none; padding: 10px 20px 0 0">
                                <label for="{{ loop.index }}">{{ counter.value }} </label>
                            </td>
                            <td style="border: none; padding: 10px 10px 0 0">
                                <select id="{{ loop.index }}"
                                        type="text"
                                        name="building"
                                        class="select">
                                    {% for in_all_building in buildings %}
                                        {% if in_all_building == building %}
                                            <option value="{{ in_all_building.id }}" selected>{{ in_all_building.building }}</option>
                                        {% else %}
                                            <option value="{{ in_all_building.id }}">{{ in_all_building.building }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </td>
                            <td style="border: none; padding: 10px 0 0 0">
                                <input type="button" value="✕" class="delete_btn"
                                       onclick="RemoveItem('d{{ loop.index }}');" id="r{{ loop.index }}">
                            </td>
                            {% set counter.value = counter.value + 1 %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <input type="button" value="Добавить поле" class="add_field" onclick="AddItem();" id="add"><br>
                <input type="submit" value="Обновить" class="add_btn">
            </div>
        </form>
    </div>
{% endblock %}
